---
services:
  ejabberd:
    image: ejabberd/ecs:latest
    container_name: ejabberd-xmpp
    restart: unless-stopped
    ports:
      - "5222:5222"  # XMPP client connections
      - "5269:5269"  # XMPP server-to-server
      - "5443:5443"  # HTTPS admin panel and API
      #- "1883:1883"  # MQTT support (optional)
    environment:
      - ERLANG_NODE_ARG=ejabberd@localhost
      - CTL_ON_CREATE=register admin chat.${DOMAIN} ${PASSWORD}
    volumes:
      - /data/config_storage/ejabberd-data:/home/ejabberd/database
      - /data/dont_backup/ejabberd-logs:/home/ejabberd/logs
      - /data/config_storage/komodo/etc_komodo/repos/compose_main/ejabberd/ejabberd.yml:/home/ejabberd/conf/ejabberd.yml:ro
