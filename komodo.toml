[[server]]
name = "holmie"
[server.config]
address = "https://periphery.holmlab.org"
enabled = false
send_unreachable_alerts = false

##

[[alerter]]
name = "ntfy"
[alerter.config]
enabled = true
endpoint.type = "Ntfy"
endpoint.params.url = "https://ntfy.holmlab.org/komodoQLKho7Ad7yV8w9tfmvA9Nl8"
alert_types = [
  "ServerUnreachable",
  "ServerMem",
  "ServerDisk",
  "StackStateChange",
  "StackImageUpdateAvailable",
  "StackAutoUpdated",
  "ContainerStateChange",
  "RepoBuildFailed",
  "BuildFailed",
  "DeploymentImageUpdateAvailable",
  "DeploymentAutoUpdated",
  "AwsBuilderTerminationFailed",
  "ResourceSyncPendingUpdates"
]
except_resources = [
  { type = "Stack", id = "681657ce336c0fdc2aca583c" },
  { type = "Stack", id = "681293e219f9998a4fbec436" }
]

##

[[procedure]]
name = "schedule_renovate"
config.webhook_enabled = false
config.schedule_format = "Cron"
config.schedule = "0 6 6 * * *"
config.schedule_timezone = "America/New_York"
config.schedule_alert = false

[[procedure.config.stage]]
name = "Stage 1"
enabled = true
executions = [
  { execution.type = "DeployStack", execution.params.stack = "renovate", execution.params.services = [], enabled = true }
]

##

[[procedure]]
name = "restart_proxy"
config.webhook_enabled = false
config.schedule_format = "Cron"
config.schedule = "0 0 */3 * * *"
config.schedule_timezone = "America/New_York"
config.schedule_alert = false

[[procedure.config.stage]]
name = "Stage 1"
enabled = true
executions = [
  { execution.type = "StopStack", execution.params.stack = "proxy", execution.params.services = [], enabled = true }
]

[[procedure.config.stage]]
name = "Stage 2"
enabled = true
executions = [
  { execution.type = "DeployStack", execution.params.stack = "proxy", execution.params.services = [], enabled = true }
]

##

[[procedure]]
name = "skywatch"
config.webhook_enabled = false
config.schedule_format = "Cron"
config.schedule = "0 * * * * *"
config.schedule_timezone = "America/New_York"
config.schedule_alert = false

[[procedure.config.stage]]
name = "Stage 1"
enabled = true
executions = [
  { execution.type = "DeployStack", execution.params.stack = "skywatch", execution.params.services = [], enabled = true }
]

##

[[resource_sync]]
name = "main"
[resource_sync.config]
git_provider = "git.holmlab.org"
repo = "shady/compose"
git_account = "komodo"
resource_path = ["komodo.toml"]
include_user_groups = true

##

[[stack]]
name = "adsb"
[stack.config]
server = "holmie"
project_name = "adsb"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "adsb"

##

[[stack]]
name = "ai"
[stack.config]
server = "holmie"
project_name = "ai"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "ai"

##

[[stack]]
name = "arr"
[stack.config]
server = "holmie"
project_name = "arr"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "arr"

##

[[stack]]
name = "audiobookshelf"
[stack.config]
server = "holmie"
project_name = "audiobookshelf"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "audiobookshelf"

##

[[stack]]
name = "dashy"
[stack.config]
server = "holmie"
project_name = "dashy"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "dashy"

##

[[stack]]
name = "dockge"
[stack.config]
server = "holmie"
project_name = "dockge"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "dockge"

##

[[stack]]
name = "filebrowser"
[stack.config]
server = "holmie"
project_name = "filebrowser"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "filebrowser"

##

[[stack]]
name = "freshrss"
[stack.config]
server = "holmie"
project_name = "freshrss"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "freshrss"

##

[[stack]]
name = "glances"
[stack.config]
server = "holmie"
project_name = "glances"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "glances"

##

[[stack]]
name = "homeassistant"
[stack.config]
server = "holmie"
project_name = "homeassistant"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "homeassistant"

##

[[stack]]
name = "immich"
[stack.config]
server = "holmie"
project_name = "immich"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "immich"

##

[[stack]]
name = "jellyfin"
[stack.config]
server = "holmie"
project_name = "jellyfin"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "jellyfin"

##

[[stack]]
name = "jellyseerr"
[stack.config]
server = "holmie"
project_name = "jellyseerr"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "jellyseerr"

##

[[stack]]
name = "kiwix"
[stack.config]
server = "holmie"
project_name = "kiwix"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "kiwix"

##

[[stack]]
name = "navidrome"
[stack.config]
server = "holmie"
project_name = "navidrome"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "navidrome"

##

[[stack]]
name = "netalertx"
[stack.config]
server = "holmie"
project_name = "netalertx"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "netalertx"

##

[[stack]]
name = "nextcloud"
[stack.config]
server = "holmie"
project_name = "nextcloud"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "nextcloud"

##

[[stack]]
name = "ntfy"
[stack.config]
server = "holmie"
project_name = "ntfy"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "ntfy"

##

[[stack]]
name = "portainer"
[stack.config]
server = "holmie"
project_name = "portainer"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "portainer"

##

[[stack]]
name = "proxy"
[stack.config]
server = "holmie"
project_name = "proxy"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "proxy"
post_deploy.command = """
sleep 10
curl -H "Priority: min" -d "proxy ip now in: $(curl --socks5 192.168.50.65:1080 ifconfig.co/country)" https://ntfy.holmlab.org/ip6yoEKIni20WOCTzG8hw4E8zRsdpk
"""

##

[[stack]]
name = "renovate"
[stack.config]
server = "holmie"
project_name = "renovate"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
reclone = false
run_directory = "renovate"

##

[[stack]]
name = "scrutiny"
[stack.config]
server = "holmie"
project_name = "scrutiny"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "scrutiny"

##

[[stack]]
name = "stirlingpdf"
[stack.config]
server = "holmie"
project_name = "stirlingpdf"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "stirlingpdf"

##

[[stack]]
name = "syncthing"
[stack.config]
server = "holmie"
project_name = "syncthing"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "syncthing"

##

[[stack]]
name = "uptime-kuma"
[stack.config]
server = "holmie"
project_name = "uptime-kuma"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "uptime-kuma"

##

[[stack]]
name = "vaultwarden"
[stack.config]
server = "holmie"
project_name = "vaultwarden"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "vaultwarden"

##

[[stack]]
name = "wireguard"
[stack.config]
server = "holmie"
project_name = "wireguard"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "wireguard"

##

[[stack]]
name = "hoodik"
[stack.config]
server = "holmie"
project_name = "hoodik"
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
run_directory = "hoodik"

##

[[stack]]
name = "skywatch"
[stack.config]
server = "holmie"
project_name = "skywatch"
auto_pull = false
run_build = false
git_provider = "git.holmlab.org"
git_account = "komodo"
repo = "shady/compose"
reclone = false
run_directory = "skywatch"
pre_deploy.command = """
  # Add multiple commands on new lines. Supports comments.
  # docker build -t skywatch .
"""
build_extra_args = []