---
services:
  anubis:
    image: ghcr.io/techarohq/anubis:v1.23.1
    container_name: anubis
    ports:
      - 8080:8080
    environment:
      # Telling Anubis, where to listen for Traefik
      - BIND=:8080
      # Telling Anubis to do redirect â€” ensure there is a space after '='
      - 'TARGET= '
      # Specifies which domains Anubis is allowed to redirect to.
      - REDIRECT_DOMAINS="anubis.${DOMAIN},speedtest.${DOMAIN},${DOMAIN}"
      # Should be the full external URL for Anubis (including scheme)
      - PUBLIC_URL="https://anubis.${DOMAIN}"
      # Should match your domain for proper cookie scoping
      - COOKIE_DOMAIN="${DOMAIN}"
      - LOG_LEVEL=debug
    security_opt:
      - no-new-privileges:true  # helps to increase security
    networks:
      - intranet
    labels:
      traefik.enable: true
      traefik.http.routers.anubis.rule: "Host(`anubis.${DOMAIN}`)"
      traefik.http.services.anubis.loadbalancer.server.port: "8080"
      traefik.http.middlewares.anubis.forwardauth.address: "http://anubis:8080/.within.website/x/cmd/anubis/api/check"

networks:
  intranet:
    external: true
