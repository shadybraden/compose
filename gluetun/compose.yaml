---
services:
  gluetun:
    container_name: gluetun
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    environment:
      - VPN_SERVICE_PROVIDER=${proxy_provider}
      - VPN_TYPE=wireguard
        # get the wg private key from https://mullvad.net/en/account/wireguard-config
        # generate key, then download any .conf. use the key and ip from that .conf below
      - WIREGUARD_PRIVATE_KEY=${proxy_private_key}
      - WIREGUARD_ADDRESSES=${proxy_address}
      - SERVER_CITIES=Adelaide,Amsterdam,"Ashburn VA",Athens,"Atlanta GA",Auckland,Belgrade,Berlin,Bogota,Bratislava,Brisbane,Brussels,Bucharest,Budapest,Calgary,"Chicago IL",Chisinau,Copenhagen,"Dallas TX","Denver CO",Dubai,Dublin,Dusseldorf,Frankfurt,Gothenburg,Helsinki,"Hong Kong","Houston TX",Johannesburg,Kyiv,Lisbon,London,"Los Angeles CA",Luxembourg,Madrid,Malm√∂,Manchester,Marseille,Melbourne,"Miami FL",Milan,Montreal,"New York NY",Osaka,Oslo,Paris,Perth,"Phoenix AZ",Prague,"Raleigh NC",Riga,"Salt Lake City UT","San Jose CA","Sao Paulo","Seattle WA","Secaucus NJ",Singapore,Skopje,Sofia,Stavanger,Stockholm,Sydney,Tallinn,"Tel Aviv",Tirana,Tokyo,Toronto,Vancouver,Vienna,Warsaw,Zagreb,Zurich
      - SHADOWSOCKS=on
      - SHADOWSOCKS_LOG=on
      - SHADOWSOCKS_PASSWORD=${proxy_shadowsocks_password}
      - DOT=off
      - DNS_PLAINTEXT_ADDRESS=${proxy_dns}
      - HTTPPROXY=on
    ports:
      - 8888:8888/tcp  # HTTP proxy
      - 8388:8388/tcp  # Shadowsocks
      - 8388:8388/udp  # Shadowsocks
      #- "51820:51820/udp"  # wireguard public port. remember to port forward this
    image: qmcgaw/gluetun:v3.40
    networks:
      - gluetun_net
      - intranet
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=intranet"
      - "traefik.http.routers.qbittorrent.entrypoints=http"
      - "traefik.http.routers.qbittorrent.rule=Host(`qbittorrent.${DOMAIN}`)"
      - "traefik.http.middlewares.qbittorrent-https-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.qbittorrent.middlewares=qbittorrent-https-redirect"
      - "traefik.http.routers.qbittorrent-secure.entrypoints=https"
      - "traefik.http.routers.qbittorrent-secure.rule=Host(`qbittorrent.${DOMAIN}`)"
      - "traefik.http.routers.qbittorrent-secure.tls=true"
      - "traefik.http.routers.qbittorrent-secure.service=qbittorrent"
      - "traefik.http.services.qbittorrent.loadbalancer.server.port=8080"  # port of the service.
      - "traefik.http.routers.jackett.entrypoints=http"
      - "traefik.http.routers.jackett.rule=Host(`jackett.${DOMAIN}`)"
      - "traefik.http.middlewares.jackett-https-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.jackett.middlewares=jackett-https-redirect"
      - "traefik.http.routers.jackett-secure.entrypoints=https"
      - "traefik.http.routers.jackett-secure.rule=Host(`jackett.${DOMAIN}`)"
      - "traefik.http.routers.jackett-secure.tls=true"
      - "traefik.http.routers.jackett-secure.service=jackett"
      - "traefik.http.services.jackett.loadbalancer.server.port=9117"  # port of the service.
      - "traefik.http.routers.search.rule=Host(`search.${DOMAIN}`)"
      - "traefik.http.middlewares.search-https-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.search.middlewares=search-https-redirect"
      - "traefik.http.routers.search-secure.entrypoints=https"
      - "traefik.http.routers.search-secure.rule=Host(`search.${DOMAIN}`)"
      - "traefik.http.routers.search-secure.tls=true"
      - "traefik.http.routers.search-secure.service=search"
      - "traefik.http.services.search.loadbalancer.server.port=27540"  # port of the service.
      - "traefik.http.routers.rss.entrypoints=http"
      - "traefik.http.routers.rss.rule=Host(`rss.${DOMAIN}`)"
      - "traefik.http.middlewares.rss-https-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.rss.middlewares=rss-https-redirect"
      - "traefik.http.routers.rss-secure.entrypoints=https"
      - "traefik.http.routers.rss-secure.rule=Host(`rss.${DOMAIN}`)"
      - "traefik.http.routers.rss-secure.tls=true"
      - "traefik.http.routers.rss-secure.service=rss"
      - "traefik.http.services.rss.loadbalancer.server.port=80"  # port of the service
      - "traefik.http.routers.wireguard_vpn.entrypoints=http"
      - "traefik.http.routers.wireguard_vpn.rule=Host(`wireguard_vpn.${DOMAIN}`)"
      - "traefik.http.middlewares.wireguard_vpn-https-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.wireguard_vpn.middlewares=wireguard_vpn-https-redirect"
      - "traefik.http.routers.wireguard_vpn-secure.entrypoints=https"
      - "traefik.http.routers.wireguard_vpn-secure.rule=Host(`wireguard_vpn.${DOMAIN}`)"
      - "traefik.http.routers.wireguard_vpn-secure.tls=true"
      - "traefik.http.routers.wireguard_vpn-secure.service=wireguard_vpn"
      - "traefik.http.services.wireguard_vpn.loadbalancer.server.port=51821"  # port of the service
      - "traefik.http.routers.tidal-ui.entrypoints=http"
      - "traefik.http.routers.tidal-ui.rule=Host(`tidal-ui.${DOMAIN}`)"
      - "traefik.http.middlewares.tidal-ui-https-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.tidal-ui.middlewares=tidal-ui-https-redirect"
      - "traefik.http.routers.tidal-ui-secure.entrypoints=https"
      - "traefik.http.routers.tidal-ui-secure.rule=Host(`tidal-ui.${DOMAIN}`)"
      - "traefik.http.routers.tidal-ui-secure.tls=true"
      - "traefik.http.routers.tidal-ui-secure.service=tidal-ui"
      - "traefik.http.services.tidal-ui.loadbalancer.server.port=5000"  # port of the service.

networks:
  gluetun_net:
    name: gluetun_net
    driver: bridge
    external: false
  intranet:
    external: true
