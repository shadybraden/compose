---
services:
  gluetun:
    container_name: gluetun
    restart: unless-stopped
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    environment:
      - VPN_SERVICE_PROVIDER=${VPN_SERVICE_PROVIDER}
      - WIREGUARD_PRIVATE_KEY=${WIREGUARD_PRIVATE_KEY}
      - WIREGUARD_ADDRESSES=${WIREGUARD_ADDRESSES}
      - DNS_PLAINTEXT_ADDRESS=${DNS_PLAINTEXT_ADDRESS}
      - SHADOWSOCKS_PASSWORD=${SHADOWSOCKS_PASSWORD}
      - WIREGUARD_PRESHARED_KEY=${WIREGUARD_PRESHARED_KEY}
      - FIREWALL_VPN_INPUT_PORTS=${TORRENTING_PORT}
      - VPN_TYPE=wireguard
#      - SERVER_CITIES=Adelaide,Amsterdam,"Ashburn VA",Athens,"Atlanta GA",Auckland,Belgrade,Berlin,Bogota,Bratislava,Brisbane,Brussels,Bucharest,Budapest,Calgary,"Chicago IL",Chisinau,Copenhagen,"Dallas TX","Denver CO",Dubai,Dublin,Dusseldorf,Frankfurt,Gothenburg,Helsinki,"Hong Kong","Houston TX",Johannesburg,Kyiv,Lisbon,London,"Los Angeles CA",Luxembourg,Madrid,Malm√∂,Manchester,Marseille,Melbourne,"Miami FL",Milan,Montreal,"New York NY",Osaka,Oslo,Paris,Perth,"Phoenix AZ",Prague,"Raleigh NC",Riga,"Salt Lake City UT","San Jose CA","Sao Paulo","Seattle WA","Secaucus NJ",Singapore,Skopje,Sofia,Stavanger,Stockholm,Sydney,Tallinn,"Tel Aviv",Tirana,Tokyo,Toronto,Vancouver,Vienna,Warsaw,Zagreb,Zurich
      - SHADOWSOCKS=on
      - SHADOWSOCKS_LOG=on
      - DOT=off
      - HTTPPROXY=on
    ports:
      - 8888:8888/tcp  # HTTP proxy
      - 8388:8388/tcp  # Shadowsocks
      - 8388:8388/udp  # Shadowsocks
      - ${TORRENTING_PORT}:${TORRENTING_PORT}  # qbit torrenting port
      # - "51820:51820/udp"  # wireguard public port. remember to port forward this
    image: qmcgaw/gluetun:v3.41.0
    networks:
      - gluetun_net
      - intranet
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=intranet"
      - "traefik.http.routers.qbittorrent.entrypoints=http"
      - "traefik.http.routers.qbittorrent.rule=Host(`qbittorrent.${DOMAIN}`)"
      - "traefik.http.middlewares.qbittorrent-https-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.qbittorrent.middlewares=qbittorrent-https-redirect"
      - "traefik.http.routers.qbittorrent-secure.entrypoints=https"
      - "traefik.http.routers.qbittorrent-secure.rule=Host(`qbittorrent.${DOMAIN}`)"
      - "traefik.http.routers.qbittorrent-secure.tls=true"
      - "traefik.http.routers.qbittorrent-secure.service=qbittorrent"
      - "traefik.http.services.qbittorrent.loadbalancer.server.port=8080"  # port of the service.
      - "traefik.http.routers.jackett.entrypoints=http"
      - "traefik.http.routers.jackett.rule=Host(`jackett.${DOMAIN}`)"
      - "traefik.http.middlewares.jackett-https-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.jackett.middlewares=jackett-https-redirect"
      - "traefik.http.routers.jackett-secure.entrypoints=https"
      - "traefik.http.routers.jackett-secure.rule=Host(`jackett.${DOMAIN}`)"
      - "traefik.http.routers.jackett-secure.tls=true"
      - "traefik.http.routers.jackett-secure.service=jackett"
      - "traefik.http.services.jackett.loadbalancer.server.port=9117"  # port of the service.
      - "traefik.http.routers.search.rule=Host(`search.${DOMAIN}`)"
      - "traefik.http.middlewares.search-https-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.search.middlewares=search-https-redirect"
      - "traefik.http.routers.search-secure.entrypoints=https"
      - "traefik.http.routers.search-secure.rule=Host(`search.${DOMAIN}`)"
      - "traefik.http.routers.search-secure.tls=true"
      - "traefik.http.routers.search-secure.service=search"
      - "traefik.http.services.search.loadbalancer.server.port=27540"  # port of the service.
      - "traefik.http.routers.rss.entrypoints=http"
      - "traefik.http.routers.rss.rule=Host(`rss.${DOMAIN}`)"
      - "traefik.http.middlewares.rss-https-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.rss.middlewares=rss-https-redirect"
      - "traefik.http.routers.rss-secure.entrypoints=https"
      - "traefik.http.routers.rss-secure.rule=Host(`rss.${DOMAIN}`)"
      - "traefik.http.routers.rss-secure.tls=true"
      - "traefik.http.routers.rss-secure.service=rss"
      - "traefik.http.services.rss.loadbalancer.server.port=80"  # port of the service
      - "traefik.http.routers.wireguard_vpn.entrypoints=http"
      - "traefik.http.routers.wireguard_vpn.rule=Host(`wireguard_vpn.${DOMAIN}`)"
      - "traefik.http.middlewares.wireguard_vpn-https-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.wireguard_vpn.middlewares=wireguard_vpn-https-redirect"
      - "traefik.http.routers.wireguard_vpn-secure.entrypoints=https"
      - "traefik.http.routers.wireguard_vpn-secure.rule=Host(`wireguard_vpn.${DOMAIN}`)"
      - "traefik.http.routers.wireguard_vpn-secure.tls=true"
      - "traefik.http.routers.wireguard_vpn-secure.service=wireguard_vpn"
      - "traefik.http.services.wireguard_vpn.loadbalancer.server.port=51821"  # port of the service
      - "traefik.http.routers.tidal-ui.entrypoints=http"
      - "traefik.http.routers.tidal-ui.rule=Host(`tidal-ui.${DOMAIN}`)"
      - "traefik.http.middlewares.tidal-ui-https-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.tidal-ui.middlewares=tidal-ui-https-redirect"
      - "traefik.http.routers.tidal-ui-secure.entrypoints=https"
      - "traefik.http.routers.tidal-ui-secure.rule=Host(`tidal-ui.${DOMAIN}`)"
      - "traefik.http.routers.tidal-ui-secure.tls=true"
      - "traefik.http.routers.tidal-ui-secure.service=tidal-ui"
      - "traefik.http.services.tidal-ui.loadbalancer.server.port=5000"  # port of the service.
      - "traefik.http.routers.mullvad.entrypoints=http"
      - "traefik.http.routers.mullvad.rule=Host(`mullvad.${DOMAIN}`)"
      - "traefik.http.middlewares.mullvad-https-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.mullvad.middlewares=mullvad-https-redirect"
      - "traefik.http.routers.mullvad-secure.entrypoints=https"
      - "traefik.http.routers.mullvad-secure.rule=Host(`mullvad.${DOMAIN}`)"
      - "traefik.http.routers.mullvad-secure.tls=true"
      - "traefik.http.routers.mullvad-secure.service=mullvad"
      - "traefik.http.services.mullvad.loadbalancer.server.port=3000"  # port of the service.
      - "traefik.http.routers.mullvad-secure.middlewares=tinyauth"
  go-socks5-proxy:
    image: serjs/go-socks5-proxy:v0.0.4
    #environment:
      #- PROXY_PASSWORD=${SHADOWSOCKS_PASSWORD}
      #- PROXY_USER=socks5
    ports:
      - 1080:1080
    container_name: socks5
    networks:
      - gluetun_net

networks:
  gluetun_net:
    name: gluetun_net
    driver: bridge
    external: false
  intranet:
    external: true
