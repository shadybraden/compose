services:
  gluetun_arr: # the vpn part
    container_name: gluetun_arr
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    environment:
      - VPN_SERVICE_PROVIDER=${arr_provider}
      - VPN_TYPE=wireguard
      - WIREGUARD_PRIVATE_KEY=${arr_private_key}
      - WIREGUARD_ADDRESSES=${arr_address}
      - SERVER_CITIES=Adelaide,Amsterdam,"Ashburn VA",Athens,"Atlanta GA",Auckland,Belgrade,Berlin,Bogota,Bratislava,Brisbane,Brussels,Bucharest,Budapest,Calgary,"Chicago IL",Chisinau,Copenhagen,"Dallas TX","Denver CO",Dubai,Dublin,Dusseldorf,Frankfurt,Gothenburg,Helsinki,"Hong Kong","Houston TX",Johannesburg,Kyiv,Lisbon,London,"Los Angeles CA",Luxembourg,Madrid,Malm√∂,Manchester,Marseille,Melbourne,"Miami FL",Milan,Montreal,"New York NY",Osaka,Oslo,Paris,Perth,"Phoenix AZ",Prague,"Raleigh NC",Riga,"Salt Lake City UT","San Jose CA","Sao Paulo","Seattle WA","Secaucus NJ",Singapore,Skopje,Sofia,Stavanger,Stockholm,Sydney,Tallinn,"Tel Aviv",Tirana,Tokyo,Toronto,Vancouver,Vienna,Warsaw,Zagreb,Zurich
    image: qmcgaw/gluetun
    restart: on-failure
    ports:
      - 8081:8081 # qbittorrent_shows
      - 8082:8082 # qbittorrent_movies
      - 9117:9117 # jackett
    security_opt:
      - no-new-privileges:true # helps to increase security
    networks:
      - intranet
    labels:
    - "traefik.enable=true"
    - "traefik.docker.network=intranet"
    - "traefik.http.routers.qbittorrent_shows.entrypoints=http"
    - "traefik.http.routers.qbittorrent_shows.rule=Host(`qbittorrent_shows.holmlab.org`)"
    - "traefik.http.middlewares.qbittorrent_shows-https-redirect.redirectscheme.scheme=https"
    - "traefik.http.routers.qbittorrent_shows.middlewares=qbittorrent_shows-https-redirect"
    - "traefik.http.routers.qbittorrent_shows-secure.entrypoints=https"
    - "traefik.http.routers.qbittorrent_shows-secure.rule=Host(`qbittorrent_shows.holmlab.org`)"
    - "traefik.http.routers.qbittorrent_shows-secure.tls=true"
    - "traefik.http.routers.qbittorrent_shows-secure.service=qbittorrent_shows"
    - "traefik.http.services.qbittorrent_shows.loadbalancer.server.port=8081" # port of the service. i.e. qbittorrent_shows likes 9000

    - "traefik.http.routers.qbittorrent_movies.entrypoints=http"
    - "traefik.http.routers.qbittorrent_movies.rule=Host(`qbittorrent_movies.holmlab.org`)"
    - "traefik.http.middlewares.qbittorrent_movies-https-redirect.redirectscheme.scheme=https"
    - "traefik.http.routers.qbittorrent_movies.middlewares=qbittorrent_movies-https-redirect"
    - "traefik.http.routers.qbittorrent_movies-secure.entrypoints=https"
    - "traefik.http.routers.qbittorrent_movies-secure.rule=Host(`qbittorrent_movies.holmlab.org`)"
    - "traefik.http.routers.qbittorrent_movies-secure.tls=true"
    - "traefik.http.routers.qbittorrent_movies-secure.service=qbittorrent_movies"
    - "traefik.http.services.qbittorrent_movies.loadbalancer.server.port=8082" # port of the service. i.e. qbittorrent_movies likes 9000

    - "traefik.http.routers.jackett.entrypoints=http"
    - "traefik.http.routers.jackett.rule=Host(`jackett.holmlab.org`)"
    - "traefik.http.middlewares.jackett-https-redirect.redirectscheme.scheme=https"
    - "traefik.http.routers.jackett.middlewares=jackett-https-redirect"
    - "traefik.http.routers.jackett-secure.entrypoints=https"
    - "traefik.http.routers.jackett-secure.rule=Host(`jackett.holmlab.org`)"
    - "traefik.http.routers.jackett-secure.tls=true"
    - "traefik.http.routers.jackett-secure.service=jackett"
    - "traefik.http.services.jackett.loadbalancer.server.port=9117" # port of the service. i.e. jackett likes 9000






  radarr: # the movie searching part
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
#    ports:
#      - 7878:7878 # radarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/New_York
      - PORT=7878
    volumes:
      - /data/config_storage/arr/radarr:/config
      - /mnt/4tb/arr/movies/torrents:/downloads/torrents
      - /mnt/4tb/arr/movies/media:/movies
    restart: on-failure
    security_opt:
      - no-new-privileges:true # helps to increase security
    networks:
      - intranet
    labels:
    - "traefik.enable=true"
    - "traefik.http.routers.radarr.entrypoints=http"
    - "traefik.http.routers.radarr.rule=Host(`radarr.holmlab.org`)"
    - "traefik.http.middlewares.radarr-https-redirect.redirectscheme.scheme=https"
    - "traefik.http.routers.radarr.middlewares=radarr-https-redirect"
    - "traefik.http.routers.radarr-secure.entrypoints=https"
    - "traefik.http.routers.radarr-secure.rule=Host(`radarr.holmlab.org`)"
    - "traefik.http.routers.radarr-secure.tls=true"
    - "traefik.http.routers.radarr-secure.service=radarr"
    - "traefik.http.services.radarr.loadbalancer.server.port=7878" # port of the service. i.e. radarr likes 9000
    - "traefik.docker.network=intranet"

  sonarr: # the show searching part
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
#    ports:
#      - 8989:8989 # sonarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/New_York
    volumes: # idea is a torrents folder for live downloads, and a media folder for sonarr to copy the files to once finished
      - /data/config_storage/arr/sonarr:/config
      - /mnt/4tb/arr/shows/torrents:/downloads/torrents
      - /mnt/4tb/arr/shows/media:/shows
    restart: on-failure
    security_opt:
      - no-new-privileges:true # helps to increase security
    networks:
      - intranet
    labels:
    - "traefik.enable=true"
    - "traefik.http.routers.sonarr.entrypoints=http"
    - "traefik.http.routers.sonarr.rule=Host(`sonarr.holmlab.org`)"
    - "traefik.http.middlewares.sonarr-https-redirect.redirectscheme.scheme=https"
    - "traefik.http.routers.sonarr.middlewares=sonarr-https-redirect"
    - "traefik.http.routers.sonarr-secure.entrypoints=https"
    - "traefik.http.routers.sonarr-secure.rule=Host(`sonarr.holmlab.org`)"
    - "traefik.http.routers.sonarr-secure.tls=true"
    - "traefik.http.routers.sonarr-secure.service=sonarr"
    - "traefik.http.services.sonarr.loadbalancer.server.port=8989" # port of the service. i.e. sonarr likes 9000
    - "traefik.docker.network=intranet"

  jackett: # mega indexer for the arr's above
    image: linuxserver/jackett:latest
    container_name: jackett
    restart: on-failure
    volumes:
      - /data/config_storage/arr/jackett:/config
    network_mode: service:gluetun_arr
    depends_on:
      gluetun_arr:
        condition: service_healthy
    security_opt:
      - no-new-privileges:true # helps to increase security

  qbittorrent_shows:
    image: lscr.io/linuxserver/qbittorrent:latest
    container_name: qbittorrent_shows
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Etc/UTC
      - WEBUI_PORT=8081
      - TORRENTING_PORT=${arr_qbittorrent_shows_port}
    volumes:
      - /data/config_storage/arr/qbittorrent_shows:/config
      - /mnt/4tb/arr/shows/torrents:/downloads/torrents
    restart: on-failure
    network_mode: service:gluetun_arr
    depends_on:
      gluetun_arr:
        condition: service_healthy
    security_opt:
      - no-new-privileges:true # helps to increase security

  qbittorrent_movies:
    image: lscr.io/linuxserver/qbittorrent:latest
    container_name: qbittorrent_movies
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Etc/UTC
      - WEBUI_PORT=8082
      - TORRENTING_PORT=${arr_qbittorrent_movies_port}
    volumes:
      - /data/config_storage/arr/qbittorrent_movies:/config
      - /mnt/4tb/arr/movies/torrents:/downloads/torrents
    restart: on-failure
    network_mode: service:gluetun_arr
    depends_on:
      gluetun_arr:
        condition: service_healthy
    security_opt:
      - no-new-privileges:true # helps to increase security

networks:
  intranet:
    external: true