services:
  mafl:
    image: hywax/mafl:v0.15.4
    restart: unless-stopped
#    ports:
#      - '3000:3000'
    volumes:
#      - /data/config_storage/mafl/:/app/data/
      - /data/config_storage/komodo/etc_komodo/stacks/mafl/mafl/config.yml:/app/data/config.yml
      - /data/config_storage/komodo/etc_komodo/stacks/dashy/dashy/icons:/app/public/icons:ro # using dashy's icons
    security_opt:
      - no-new-privileges:true # helps to increase security
    networks:
      - intranet
    labels:
    - "traefik.enable=true"
    - "traefik.http.routers.dash.entrypoints=http"
    - "traefik.http.routers.dash.rule=Host(`dash.${DOMAIN}`)"
    - "traefik.http.middlewares.dash-https-redirect.redirectscheme.scheme=https"
    - "traefik.http.routers.dash.middlewares=dash-https-redirect"
    - "traefik.http.routers.dash-secure.entrypoints=https"
    - "traefik.http.routers.dash-secure.rule=Host(`dash.${DOMAIN}`)"
    - "traefik.http.routers.dash-secure.tls=true"
    - "traefik.http.routers.dash-secure.service=dash"
    - "traefik.http.services.dash.loadbalancer.server.port=3000" # port of the service.
    - "traefik.docker.network=intranet"

networks:
  intranet:
    external: true